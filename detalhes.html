<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/detalhes1.css">
    <title>Detalhes da Vaga</title>
</head>

<body>
    <div class="detalhes-container">
        <h1>Detalhes da Vaga</h1>

        <div id="vaga-detalhes">
            <p><strong>Nome:</strong> <span id="modal-titulo"></span></p>
            <p><strong>Descrição:</strong> <span id="modal-descricao"></span></p>
            <p><strong>Contato:</strong> <span id="modal-contato"></span></p>
            <p><strong>Benefício:</strong> <span id="modal-beneficio"></span></p>
            <p><strong>Salário:</strong> <span id="modal-salario"></span></p>
            <p><strong>Local:</strong> <span id="modal-local"></span></p>
            <p><strong>Carga Horária:</strong> <span id="modal-cargaHoraria"></span></p>
            <p><strong>Tipo de Contratação:</strong> <span id="modal-tipoContratacao"></span></p>
            <p><strong>Tipo de Vaga:</strong> <span id="modal-tipoVaga"></span></p>

            <h3>Requisitos</h3>
            <ul id="modal-requisitos"></ul>

            <div class="botao-container">
                <button onclick="voltarParaLista()" class="btn-voltar">Voltar</button>
                <button onclick="salvarVaga()" class="btn-salvar">Salvar</button>
                <button onclick="compartilharVaga()" class="btn-compartilhar">Compartilhar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Obtém os parâmetros da URL
            const params = new URLSearchParams(window.location.search);
            const vagaId = params.get('id'); // Obtém o ID da vaga

            if (!vagaId) {
                document.getElementById('vaga-detalhes').innerHTML = "<p>Vaga não encontrada.</p>";
                return;
            }

            // Recupera as vagas do localStorage
            const vagasPublicadas = JSON.parse(localStorage.getItem('planoBasico')) || [];

            // Adiciona um log para verificar o conteúdo do localStorage
            console.log("Vagas no localStorage:", vagasPublicadas);

            // Garante que o id seja do tipo correto para a comparação (string ou número)
            const vaga = vagasPublicadas.find(vaga => String(vaga.id) === String(vagaId)); // Garantir que ambos os ids sejam strings

            if (!vaga) {
                document.getElementById('vaga-detalhes').innerHTML = "<p>Vaga não encontrada.</p>";
                return;
            }

            // Exibe as informações da vaga
            document.getElementById('modal-titulo').innerText = vaga.nome;
            document.getElementById('modal-descricao').innerText = vaga.descricao;
            document.getElementById('modal-contato').innerText = vaga.contato;
            document.getElementById('modal-beneficio').innerText = vaga.beneficio;
            document.getElementById('modal-salario').innerText = vaga.salario;
            document.getElementById('modal-local').innerText = vaga.local;
            document.getElementById('modal-cargaHoraria').innerText = vaga.cargaHoraria;
            document.getElementById('modal-tipoContratacao').innerText = vaga.tipoContratacao;
            document.getElementById('modal-tipoVaga').innerText = vaga.tipoVaga;

            // Exibe os requisitos, caso existam
            const requisitosList = document.getElementById('modal-requisitos');
            requisitosList.innerHTML = ''; // Limpa a lista de requisitos

            // Verifica se 'requisitos' é um array e se não está vazio
            if (Array.isArray(vaga.requisitos) && vaga.requisitos.length > 0) {
                vaga.requisitos.forEach(requisito => {
                    const listItem = document.createElement('li');
                    listItem.innerText = requisito;
                    requisitosList.appendChild(listItem);
                });
            } else {
                // Caso não haja requisitos, exibe uma mensagem
                requisitosList.innerHTML = "<li>Não especificado</li>";
            }
        });

        function voltarParaLista() {
            window.location.href = "index.html";
        }

        function salvarVaga() {
            const urlParams = new URLSearchParams(window.location.search);
            const vagaId = urlParams.get("id");
            const vagas = JSON.parse(localStorage.getItem("planoBasico")) || [];
            const vaga = vagas.find(v => String(v.id) === String(vagaId));

            if (vaga) {
                const vagasSalvas = JSON.parse(localStorage.getItem("vagasSalvas")) || [];
                if (!vagasSalvas.some(v => v.id === vaga.id)) {
                    vagasSalvas.push(vaga);
                    localStorage.setItem("vagasSalvas", JSON.stringify(vagasSalvas));
                    alert("Vaga salva com sucesso!");
                } else {
                    alert("Esta vaga já foi salva anteriormente.");
                }
                window.location.href = "salvas.html";
            }
        }

        function compartilharVaga() {
            const urlParams = new URLSearchParams(window.location.search);
            const vagaId = urlParams.get("id");
            const vagas = JSON.parse(localStorage.getItem("planoBasico")) || [];
            const vaga = vagas.find(v => String(v.id) === String(vagaId));

            if (vaga) {
                const vagaLink = window.location.href;
                const textoCompartilhar = `Confira esta vaga: ${vaga.nome} - ${vagaLink}`;
                if (navigator.share) {
                    navigator.share({
                        title: "Vaga de Emprego",
                        text: textoCompartilhar,
                        url: vagaLink,
                    }).catch(error => {
                        alert("Erro ao compartilhar a vaga: " + error);
                    });
                } else {
                    navigator.clipboard.writeText(textoCompartilhar).then(() => {
                        alert("Link da vaga copiado para a área de transferência!");
                    }).catch(error => {
                        alert("Erro ao copiar o link: " + error);
                    });
                }
            }
        }
    </script>
</body>

</html>
